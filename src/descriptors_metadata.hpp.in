#ifndef __LIBARCSDEC_DESCRIPTORS_METADATA_HPP__
#define __LIBARCSDEC_DESCRIPTORS_METADATA_HPP__

/**
 * \file descriptors_metadata.hpp.in Provide compiled-in @link MetadataParserDescriptor MetadataParserDescriptors @endlink.
 *
 * This information is controlled by cmake. It is made accessible at build time
 * for program scope.
 */

#include <memory>
#include <vector>

#include "@PROJECT_SOURCE_DIR@/parsercue.hpp"


// Configure available features


// Device (via libcdio)

#cmakedefine WITH_LIBCDIO  // will be defined iff compiled with libcdio support

#ifdef WITH_LIBCDIO
	#include "@PROJECT_SOURCE_DIR@/parsercdio.hpp"
#endif


namespace arcsdec
{

inline namespace v_1_0_0
{

/**
 * List of supported audio file formats.
 *
 * The actual list entries are controlled by CMake at buildtime.
 *
 * \internal
 * \ingroup metaparser
 */
class FileReaderDescriptorsMetadata final
{
	using container_type = std::vector<std::unique_ptr<FileReaderDescriptor>>;


public:

	using iterator = container_type::iterator;

	using const_iterator = container_type::const_iterator;

	/**
	 * Default constructor. Adds all available formats to the instance.
	 */
	FileReaderDescriptorsMetadata()
		: formats_()
	{
		formats_.reserve(2);

		formats_.push_back(std::make_unique<DescriptorCUE>());

#ifdef WITH_LIBCDIO
		formats_.push_back(std::make_unique<DescriptorCdio>());
#endif
	}

	/**
	 * Iterator pointing to the first format
	 */
	iterator begin()
	{
		return formats_.begin();
	}

	/**
	 * Iterator pointing behind the last format
	 */
	iterator end()
	{
		return formats_.end();
	}

	/**
	 * Iterator pointing to the first format
	 */
	const_iterator begin() const
	{
		return formats_.begin();
	}

	/**
	 * Iterator pointing behind the last format
	 */
	const_iterator end() const
	{
		return formats_.end();
	}

	/**
	 * Iterator pointing to the first format
	 */
	const_iterator cbegin() const
	{
		return formats_.cbegin();
	}

	/**
	 * Iterator pointing behind the last format
	 */
	const_iterator cend() const
	{
		return formats_.cend();
	}


private:

	/**
	 * List of available file formats
	 */
	container_type formats_;
};

} // namespace v_1_0_0

} // namespace arcsdec


// Restrict scope of cmake-controlled variables to this file

#ifdef WITH_LIBCDIO
	#undef WITH_LIBCDIO
#endif

#endif

